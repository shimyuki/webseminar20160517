package window.whiteboard.slide {	import flash.display.*;	import flash.geom.*;	import common.*;	import window.*;	import window.whiteboard.imgdoc.Doc;	import flash.text.*;	import flash.events.*;	import flash.net.*;	import window.whiteboard.imgdoc.DocEvent;	import window.whiteboard.imgdoc.Dir;	import window.whiteboard.imgdoc.Dir_top;		// ホワイトボードに表示する１枚のスライド	public class ImgWbSlide extends WbSlide {		//private var m_bmp:Bitmap = null; // 背景用の画像		private var m_doc:Doc; // 画像背景の場合の画像ID				public function ImgWbSlide( bgtype:String, doc:Doc) {			super( bgtype);						m_doc = doc;			//m_bmp = Bitmap( m_bg.addChild( new Bitmap( null, "auto", true)));		}				override public function initSo( nc:NetConnection) {			m_livePointerCon.initSo( Main.CONF.CLASS_ID + m_doc.getId(), nc);			onLivePointerStatusChanged();		}				// WhiteboardContainer経由でWhiteboardからも呼ばれる		override public function unsetBg() {			super.unsetBg();						for( var i = 0; i < m_bg.numChildren; i++) {				if( m_bg.getChildAt( i) as Loader != null) {					var imgLoader:Loader = Loader( m_bg.getChildAt( i));					imgLoader.unload();					imgLoader.contentLoaderInfo.removeEventListener( Event.COMPLETE, onComplete);					imgLoader.contentLoaderInfo.removeEventListener ( IOErrorEvent.IO_ERROR, onLoadError ); 					m_bg.removeChild( imgLoader);					i--;				}			}//Main.addDebugMsg( "ImgWbSlide:unsetBg:" + m_doc.getPath());					}				// WhiteboardContainer経由でWhiteboardからSharedObjectの値変更時に呼ばれる		override public function setBg() {			super.setBg();			var imgLoader:Loader = new Loader();			imgLoader.contentLoaderInfo.addEventListener( Event.COMPLETE, onComplete);			imgLoader.contentLoaderInfo.addEventListener ( IOErrorEvent.IO_ERROR, onLoadError ); 			imgLoader.load( new URLRequest( getDocUrl()));						m_bg.addChild( imgLoader);//Main.addDebugMsg( "ImgWbSlide:setBg:" + imgLoader + m_bg + m_bg.parent + m_bg.parent.parent + "x:" + x + ", y:" + y );					}		function getDocUrl() :String {			return Main.CONF.getParam( 'LIVECLASS_DOC_URL') + Main.CONF.CLASS_ID + "/" + getParentName( m_doc) + m_doc.name;		}		function getParentName( dir:Dir) :String {			if( dir.parent as Dir_top != null) return "";			if( dir.parent == null) return "";						var ret = dir.parent.name + '/';			if( dir.parent as Dir != null) {				ret = getParentName( Dir( dir.parent)) + ret;			}			return ret;		}		function onComplete( e:Event) {						dispatchEvent( new Event( WbSlide.BG_COMPLETE));					}		function onLoadError( e:IOErrorEvent) {			Main.addErrMsg(  "ImgWbSlide: Cannot load: " + getDocUrl());		}							public function getDocId() : String { return m_doc.getId();}	}}